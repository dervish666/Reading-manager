(()=>{"use strict";var e,t,s,n,r,a,i={1464:function(e,t,s){var n=s(4848),r=s(6540),a=s(5338),i=s(4976),o=s(7767),l=s(340),d=s(3559),c=s(6380),h=s(4622);let x={selectedClassFilter:localStorage.getItem("selectedClassFilter")||"",students:[],classes:[],books:[],genres:[],sessions:[],settings:null,loading:!1,error:null,filters:{students:{},sessions:{},books:{}},sorting:{students:{column:null,direction:null},sessions:{column:null,direction:null},books:{column:null,direction:null}},sortingLoading:{students:!1,sessions:!1,books:!1}},u="SET_LOADING",m="SET_SELECTED_CLASS_FILTER",p="SET_ERROR",g="CLEAR_ERROR",y="SET_STUDENTS",j="ADD_STUDENT",A="UPDATE_STUDENT",f="DELETE_STUDENT",b="SET_CLASSES",v="ADD_CLASS",S="UPDATE_CLASS",k="DELETE_CLASS",C="SET_BOOKS",w="ADD_BOOK",I="UPDATE_BOOK",D="DELETE_BOOK",L="SET_GENRES",T="ADD_GENRE",E="UPDATE_GENRE",R="DELETE_GENRE",O="SET_SESSIONS",W="ADD_SESSION",B="UPDATE_SESSION",P="DELETE_SESSION",N="SET_SETTINGS",z="UPDATE_SETTINGS",F="SET_FILTER",G="CLEAR_FILTERS",M="SET_SORT",$="CLEAR_SORT",_="SET_SORTING_LOADING";function H(e,t){switch(t.type){case u:return{...e,loading:t.payload};case m:return t.payload?localStorage.setItem("selectedClassFilter",t.payload):localStorage.removeItem("selectedClassFilter"),{...e,selectedClassFilter:t.payload};case p:return{...e,error:t.payload,loading:!1};case g:return{...e,error:null};case y:return{...e,students:t.payload};case j:return{...e,students:[...e.students,t.payload]};case A:return{...e,students:e.students.map(e=>e.id===t.payload.id?t.payload:e)};case f:return{...e,students:e.students.filter(e=>e.id!==t.payload)};case b:return{...e,classes:t.payload};case v:return{...e,classes:[...e.classes,t.payload]};case S:return{...e,classes:e.classes.map(e=>e.id===t.payload.id?t.payload:e)};case k:return{...e,classes:e.classes.filter(e=>e.id!==t.payload)};case C:return{...e,books:t.payload};case w:return{...e,books:[...e.books,t.payload]};case I:return{...e,books:e.books.map(e=>e.id===t.payload.id?t.payload:e)};case D:return{...e,books:e.books.filter(e=>e.id!==t.payload)};case L:return{...e,genres:t.payload};case T:return{...e,genres:[...e.genres,t.payload]};case E:return{...e,genres:e.genres.map(e=>e.id===t.payload.id?t.payload:e)};case R:return{...e,genres:e.genres.filter(e=>e.id!==t.payload)};case O:return{...e,sessions:t.payload};case W:return{...e,sessions:[...e.sessions,t.payload]};case B:return{...e,sessions:e.sessions.map(e=>e.id===t.payload.id?t.payload:e)};case P:return{...e,sessions:e.sessions.filter(e=>e.id!==t.payload)};case N:return{...e,settings:t.payload};case z:return{...e,settings:{...e.settings,...t.payload}};case F:return{...e,filters:{...e.filters,[t.entity]:{...e.filters[t.entity],...t.payload}}};case G:return{...e,filters:x.filters};case M:return{...e,sorting:{...e.sorting,[t.entity]:{column:t.payload.column,direction:t.payload.direction}}};case $:return{...e,sorting:{...e.sorting,[t.entity]:{column:null,direction:null}}};case _:return{...e,sortingLoading:{...e.sortingLoading,[t.entity]:t.payload}};default:return e}}let U=(0,r.createContext)();async function J(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=`/api${e}`,n={headers:{"Content-Type":"application/json",...t.headers}},r=await fetch(s,{...n,...t});if(!r.ok){var a;throw Error((null==(a=(await r.json().catch(()=>({}))).error)?void 0:a.message)||`HTTP error! status: ${r.status}`)}return r.json()}function q(e){let{children:t}=e,[s,a]=(0,r.useReducer)(H,x),i={async getStudents(){a({type:u,payload:!0});try{let e=await J("/students");return a({type:y,payload:e.data}),e.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:u,payload:!1})}},async createStudent(e){try{let t=await J("/students",{method:"POST",body:JSON.stringify(e)});return a({type:j,payload:t.data}),t.data}catch(e){throw a({type:p,payload:e.message}),e}},async updateStudent(e,t){try{let s=await J(`/students/${e}`,{method:"PUT",body:JSON.stringify(t)});return a({type:A,payload:s.data}),s.data}catch(e){throw a({type:p,payload:e.message}),e}},async deleteStudent(e){try{await J(`/students/${e}`,{method:"DELETE"}),a({type:f,payload:e})}catch(e){throw a({type:p,payload:e.message}),e}},async bulkImportStudents(e){try{let t=await J("/students/bulk",{method:"POST",body:JSON.stringify({students:e})});return t.data.created.forEach(e=>{a({type:j,payload:e})}),t}catch(e){throw a({type:p,payload:e.message}),e}},async getClasses(){a({type:u,payload:!0});try{let e=await J("/classes");return a({type:b,payload:e.data}),e.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:u,payload:!1})}},async createClass(e){try{let t=await J("/classes",{method:"POST",body:JSON.stringify(e)});return a({type:v,payload:t.data}),t.data}catch(e){throw a({type:p,payload:e.message}),e}},async updateClass(e,t){try{let s=await J(`/classes/${e}`,{method:"PUT",body:JSON.stringify(t)});return a({type:S,payload:s.data}),s.data}catch(e){throw a({type:p,payload:e.message}),e}},async deleteClass(e){try{await J(`/classes/${e}`,{method:"DELETE"}),a({type:k,payload:e})}catch(e){throw a({type:p,payload:e.message}),e}},async getBooks(){a({type:u,payload:!0});try{let e=await J("/books");return a({type:C,payload:e.data}),e.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:u,payload:!1})}},async createBook(e){try{let t=await J("/books",{method:"POST",body:JSON.stringify(e)});return a({type:w,payload:t.data}),t.data}catch(e){throw a({type:p,payload:e.message}),e}},async updateBook(e,t){try{let s=await J(`/books/${e}`,{method:"PUT",body:JSON.stringify(t)});return a({type:I,payload:s.data}),s.data}catch(e){throw a({type:p,payload:e.message}),e}},async deleteBook(e){try{await J(`/books/${e}`,{method:"DELETE"}),a({type:D,payload:e})}catch(e){throw a({type:p,payload:e.message}),e}},async getGenres(){a({type:u,payload:!0});try{let e=await J("/genres");return a({type:L,payload:e.data}),e.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:u,payload:!1})}},async createGenre(e){try{let t=await J("/genres",{method:"POST",body:JSON.stringify(e)});return a({type:T,payload:t.data}),t.data}catch(e){throw a({type:p,payload:e.message}),e}},async updateGenre(e,t){try{let s=await J(`/genres/${e}`,{method:"PUT",body:JSON.stringify(t)});return a({type:E,payload:s.data}),s.data}catch(e){throw a({type:p,payload:e.message}),e}},async deleteGenre(e){try{await J(`/genres/${e}`,{method:"DELETE"}),a({type:R,payload:e})}catch(e){throw a({type:p,payload:e.message}),e}},async getSessions(){a({type:u,payload:!0});try{let e=await J("/sessions");return a({type:O,payload:e.data}),e.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:u,payload:!1})}},async createSession(e){try{let t=await J("/sessions",{method:"POST",body:JSON.stringify(e)});return a({type:W,payload:t.data}),t.data}catch(e){throw a({type:p,payload:e.message}),e}},async updateSession(e,t){try{let s=await J(`/sessions/${e}`,{method:"PUT",body:JSON.stringify(t)});return a({type:B,payload:s.data}),s.data}catch(e){throw a({type:p,payload:e.message}),e}},async deleteSession(e){try{await J(`/sessions/${e}`,{method:"DELETE"}),a({type:P,payload:e})}catch(e){throw a({type:p,payload:e.message}),e}},async getSessionsByStudent(e){try{return(await J(`/sessions/student/${e}`)).data}catch(e){throw a({type:p,payload:e.message}),e}},async getRecommendations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{return(await J("/recommendations",{method:"POST",body:JSON.stringify({studentId:e,limit:t})})).data}catch(e){throw a({type:p,payload:e.message}),e}},async getSettings(){try{let e=await J("/settings");return a({type:N,payload:e.data}),e.data}catch(e){throw a({type:p,payload:e.message}),e}},async updateSettings(e){try{let t=await J("/settings",{method:"PUT",body:JSON.stringify(e)});return a({type:z,payload:t.data}),t.data}catch(e){throw a({type:p,payload:e.message}),e}},async exportData(){try{return(await J("/data/export")).data}catch(e){throw a({type:p,payload:e.message}),e}},async importData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await J("/data/import",{method:"POST",body:JSON.stringify({data:e,options:t})})}catch(e){throw a({type:p,payload:e.message}),e}},clearError(){a({type:g})},setFilter(e,t){a({type:F,entity:e,payload:t})},setSelectedClassFilter(e){a({type:m,payload:e})},clearFilters(){a({type:G})},setSort(e,t,s){a({type:M,entity:e,payload:{column:t,direction:s}})},clearSort(e){a({type:$,entity:e})},setSortingLoading(e,t){a({type:_,entity:e,payload:t})},async getStudentsSorted(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a({type:_,entity:"students",payload:!0});try{let s=new URLSearchParams;e&&t&&(s.append("sortBy",e),s.append("sortOrder",t));let n=s.toString()?`/students?${s.toString()}`:"/students",r=await J(n);return a({type:y,payload:r.data}),r.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:_,entity:"students",payload:!1})}},async getSessionsSorted(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a({type:_,entity:"sessions",payload:!0});try{let s=new URLSearchParams;e&&t&&(s.append("sortBy",e),s.append("sortOrder",t));let n=s.toString()?`/sessions?${s.toString()}`:"/sessions",r=await J(n);return a({type:O,payload:r.data}),r.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:_,entity:"sessions",payload:!1})}},async getBooksSorted(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a({type:_,entity:"books",payload:!0});try{let s=new URLSearchParams;e&&t&&(s.append("sortBy",e),s.append("sortOrder",t));let n=s.toString()?`/books?${s.toString()}`:"/books",r=await J(n);return a({type:C,payload:r.data}),r.data}catch(e){throw a({type:p,payload:e.message}),e}finally{a({type:_,entity:"books",payload:!1})}}};return(0,r.useEffect)(()=>{(async()=>{try{await Promise.all([i.getStudents(),i.getClasses(),i.getBooks(),i.getGenres(),i.getSessions(),i.getSettings()])}catch(e){console.error("Error loading initial data:",e)}})()},[]),(0,n.jsx)(U.Provider,{value:{state:s,setSelectedClassFilter:e=>{a({type:m,payload:e})},dispatch:a,api:i},children:t})}function Y(){let e=(0,r.useContext)(U);if(!e)throw Error("useApp must be used within an AppProvider");return e}var K=s(2292),V=s(7714),Z=s(1536),Q=s(7292),X=s(4487),ee=s(4195),et=s(8649),es=s(5124),en=s(6046),er=s(7898),ea=s(1295),ei=s(4511),eo=s(3459),el=s(3988),ed=s(4478),ec=s(5502),eh=s(5604),ex=s(5554),eu=s(9368),em=s(3430),ep=s(1117),eg=s(8105),ey=s(4248),ej=s(205),eA=s(3108),ef=s(4527),eb=s(6453);let ev=[{text:"Dashboard",icon:(0,n.jsx)(ex.A,{}),path:"/"},{text:"Students",icon:(0,n.jsx)(eu.A,{}),path:"/students"},{text:"Reading Sessions",icon:(0,n.jsx)(em.A,{}),path:"/sessions"},{text:"Books",icon:(0,n.jsx)(ep.A,{}),path:"/books"},{text:"Classes",icon:(0,n.jsx)(eg.A,{}),path:"/classes"},{text:"Genres",icon:(0,n.jsx)(ey.A,{}),path:"/genres"},{text:"Recommendations",icon:(0,n.jsx)(eg.A,{}),path:"/recommendations"},{text:"Settings",icon:(0,n.jsx)(ej.A,{}),path:"/settings"}],eS=function(e){var t;let{children:s}=e,a=(0,K.A)(),i=(0,o.Zp)(),l=(0,o.zy)(),{state:d,setSelectedClassFilter:c}=Y();c||console.error("setSelectedClassFilter is not available in context");let[x,u]=(0,r.useState)(!1),m=(0,V.A)(a.breakpoints.down("md")),p=()=>{u(!x)},g=(0,n.jsxs)(h.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,n.jsxs)(Z.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:[2],py:2,borderBottom:"1px solid rgba(0, 0, 0, 0.05)"},children:[(0,n.jsx)(Q.A,{variant:"h6",noWrap:!0,component:"div",color:"primary",fontWeight:600,children:"Reading Assistant"}),m&&(0,n.jsx)(X.A,{onClick:p,sx:{ml:1},children:(0,n.jsx)(eA.A,{})})]}),(0,n.jsxs)(h.A,{sx:{flexGrow:1,overflow:"auto",py:1},children:[(0,n.jsx)(ee.A,{sx:{px:1},children:ev.map(e=>(0,n.jsx)(et.Ay,{disablePadding:!0,sx:{mb:.5},children:(0,n.jsxs)(es.A,{selected:l.pathname===e.path,onClick:()=>{i(e.path),m&&u(!1)},sx:{borderRadius:2,"&.Mui-selected":{backgroundColor:"rgba(99, 102, 241, 0.1)",color:a.palette.primary.main,"& .MuiListItemIcon-root":{color:a.palette.primary.main},"&:hover":{backgroundColor:"rgba(99, 102, 241, 0.15)"}},"&:hover":{backgroundColor:"rgba(99, 102, 241, 0.05)"}},children:[(0,n.jsx)(en.A,{sx:{minWidth:40},children:e.icon}),(0,n.jsx)(er.A,{primary:e.text,primaryTypographyProps:{fontSize:"0.875rem",fontWeight:l.pathname===e.path?600:400}})]})},e.text))}),(0,n.jsx)(h.A,{sx:{px:2,py:2},children:(0,n.jsxs)(ea.A,{fullWidth:!0,size:"small",children:[(0,n.jsx)(ei.A,{id:"class-filter-label",children:"Filter by Class"}),(0,n.jsxs)(eo.A,{labelId:"class-filter-label",value:d.selectedClassFilter,onChange:e=>c&&c(e.target.value),label:"Filter by Class",children:[(0,n.jsx)(el.A,{value:"",children:(0,n.jsx)("em",{children:"All Classes"})}),d.classes.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))]})]})})]})]});return(0,n.jsxs)(h.A,{sx:{display:"flex"},children:[(0,n.jsx)(ed.A,{position:"fixed",sx:{width:{md:"calc(100% - 280px)"},ml:{md:"280px"},backgroundColor:"#ffffff",color:"#1e293b",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1)"},children:(0,n.jsxs)(Z.A,{sx:{minHeight:"64px"},children:[(0,n.jsx)(X.A,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:p,sx:{mr:2,display:{md:"none"}},children:(0,n.jsx)(ef.A,{})}),(0,n.jsx)(Q.A,{variant:"h6",noWrap:!0,component:"div",fontWeight:600,children:(null==(t=ev.find(e=>e.path===l.pathname))?void 0:t.text)||"Reading Assistant"})]})}),(0,n.jsxs)(h.A,{component:"nav",sx:{width:{md:280},flexShrink:{md:0},"& .MuiDrawer-paper":{backgroundColor:"#ffffff",borderRight:"1px solid rgba(0, 0, 0, 0.05)"}},"aria-label":"navigation",children:[(0,n.jsx)(ec.Ay,{variant:"temporary",open:x,onClose:p,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:280}},children:g}),(0,n.jsx)(ec.Ay,{variant:"permanent",sx:{display:{xs:"none",md:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:280}},open:!0,children:g})]}),(0,n.jsxs)(h.A,{component:"main",sx:{flexGrow:1,p:3,width:{md:"calc(100% - 280px)"},mt:8,backgroundColor:"#f8fafc",minHeight:"100vh"},children:[s,(0,n.jsx)(eh.A,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:24,right:24,width:56,height:56,boxShadow:"0 4px 12px rgba(99, 102, 241, 0.3)",transition:"all 0.2s ease-in-out","&:hover":{transform:"scale(1.05)",boxShadow:"0 6px 16px rgba(99, 102, 241, 0.4)"}},onClick:()=>{let e=l.pathname;"/students"===e?i("/students?action=new"):"/sessions"===e?i("/sessions?action=new"):"/books"===e?i("/books?action=new"):"/classes"===e?i("/classes?action=new"):"/genres"===e&&i("/genres?action=new")},children:(0,n.jsx)(eb.A,{})})]})]})};var ek=s(6596),eC=s(478),ew=s(5433),eI=s(5663),eD=s(6740),eL=s(560),eT=s(5709),eE=s(537),eR=s(3328),eO=s(5101),eW=s(1192),eB=s(1076);let eP=function(){var e;let t=(0,o.Zp)(),{state:s}=Y(),r=(0,K.A)(),{students:a,sessions:i,books:l,classes:d}=s,c=s.selectedClassFilter?i.filter(e=>{let t=a.find(t=>t.id===e.studentId);return(null==t?void 0:t.classId)===s.selectedClassFilter}):i,x=a.length,u=c.length,m=l.length,p=d.length,g=c.sort((e,t)=>new Date(t.date)-new Date(e.date)).slice(0,5),y=s.settings,j=(null==y||null==(e=y.readingStatusSettings)?void 0:e.needsAttentionDays)||14,A=new Date;A.setDate(A.getDate()-j);let f=a.filter(e=>!e.lastReadDate||new Date(e.lastReadDate)<A),b=a.reduce((e,t)=>{let s=t.readingLevel||"Not Set";return e[s]=(e[s]||0)+1,e},{}),v=new Date().toDateString(),S=c.filter(e=>new Date(e.date).toDateString()===v).length,k=e=>{let{title:t,value:s,icon:a,color:i="primary",subtitle:o}=e;return(0,n.jsxs)(ek.A,{sx:{height:"100%",position:"relative",overflow:"hidden"},children:[(0,n.jsx)(eC.A,{sx:{p:3},children:(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{color:"textSecondary",gutterBottom:!0,variant:"subtitle2",fontWeight:500,children:t}),(0,n.jsx)(Q.A,{variant:"h3",component:"div",color:`${i}.main`,fontWeight:700,children:s}),o&&(0,n.jsx)(Q.A,{color:"textSecondary",variant:"body2",sx:{mt:.5},children:o})]}),(0,n.jsx)(ew.A,{sx:{bgcolor:`${i}.main`,width:64,height:64,boxShadow:`0 4px 12px ${r.palette[i].main}20`},children:a})]})}),(0,n.jsx)(h.A,{sx:{position:"absolute",bottom:0,left:0,right:0,height:4,backgroundColor:`${i}.main`,opacity:.8}})]})},C=e=>new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),w=e=>"school"===e?"primary":"secondary";return(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"h4",gutterBottom:!0,children:"Dashboard"}),(0,n.jsxs)(eI.A,{container:!0,spacing:3,sx:{mb:4},children:[(0,n.jsx)(eI.A,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(k,{title:"Total Students",value:x,icon:(0,n.jsx)(eu.A,{}),color:"primary"})}),(0,n.jsx)(eI.A,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(k,{title:"Reading Sessions",value:u,icon:(0,n.jsx)(em.A,{}),color:"success",subtitle:`${S} today`})}),(0,n.jsx)(eI.A,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(k,{title:"Books Available",value:m,icon:(0,n.jsx)(eg.A,{}),color:"warning"})}),(0,n.jsx)(eI.A,{item:!0,xs:12,sm:6,md:3,children:(0,n.jsx)(k,{title:"Classes",value:p,icon:(0,n.jsx)(eO.A,{}),color:"info"})})]}),(0,n.jsxs)(eI.A,{container:!0,spacing:3,children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(ek.A,{sx:{height:"100%"},children:(0,n.jsxs)(eC.A,{sx:{p:3},children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h6",fontWeight:600,children:"Students Needing Attention"}),(0,n.jsx)(eD.A,{label:`${f.length} students`,color:"warning",variant:"outlined",size:"small"})]}),f.length>0?(0,n.jsxs)(ee.A,{sx:{p:0},children:[f.slice(0,5).map(e=>(0,n.jsxs)(et.Ay,{sx:{px:0,borderRadius:2,mb:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.02)"}},children:[(0,n.jsx)(eL.A,{children:(0,n.jsx)(ew.A,{sx:{bgcolor:"warning.main",width:40,height:40},children:(0,n.jsx)(eu.A,{fontSize:"small"})})}),(0,n.jsx)(er.A,{primary:e.name,primaryTypographyProps:{fontWeight:500},secondary:e.lastReadDate?`Last read: ${C(e.lastReadDate)}`:"Never read",secondaryTypographyProps:{fontSize:"0.875rem"}}),(0,n.jsx)(eT.A,{children:(0,n.jsx)(X.A,{edge:"end",onClick:()=>t(`/students/${e.id}`),sx:{"&:hover":{color:"warning.main"}},children:(0,n.jsx)(eW.A,{})})})]},e.id)),f.length>5&&(0,n.jsx)(et.Ay,{sx:{px:0},children:(0,n.jsx)(er.A,{primary:`... and ${f.length-5} more`,primaryTypographyProps:{color:"textSecondary",fontSize:"0.875rem"}})})]}):(0,n.jsx)(h.A,{textAlign:"center",py:3,children:(0,n.jsx)(Q.A,{color:"textSecondary",variant:"body1",children:"All students are up to date! \uD83C\uDF89"})}),(0,n.jsx)(h.A,{mt:3,children:(0,n.jsx)(eE.A,{variant:"outlined",fullWidth:!0,onClick:()=>t("/students"),sx:{py:1.5},children:"View All Students"})})]})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(ek.A,{sx:{height:"100%"},children:(0,n.jsxs)(eC.A,{sx:{p:3},children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h6",fontWeight:600,children:"Recent Reading Sessions"}),(0,n.jsx)(eD.A,{label:`${g.length} recent`,color:"success",variant:"outlined",size:"small"})]}),g.length>0?(0,n.jsx)(ee.A,{sx:{p:0},children:g.map(e=>{var t;return(0,n.jsxs)(et.Ay,{sx:{px:0,borderRadius:2,mb:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.02)"}},children:[(0,n.jsx)(eL.A,{children:(0,n.jsx)(ew.A,{sx:{bgcolor:w(e.environment),width:40,height:40},children:"school"===e.environment?"S":"H"})}),(0,n.jsx)(er.A,{primary:`${e.bookTitle} by ${e.author}`,primaryTypographyProps:{fontSize:"0.875rem",fontWeight:500,noWrap:!0},secondary:(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"body2",component:"span",children:null==(t=a.find(t=>t.id===e.studentId))?void 0:t.name}),(0,n.jsx)("br",{}),(0,n.jsxs)(Q.A,{variant:"caption",color:"textSecondary",children:[C(e.date)," • ",e.assessment]})]})}),(0,n.jsx)(eT.A,{children:(0,n.jsx)(eD.A,{label:e.environment,size:"small",color:w(e.environment),variant:"outlined"})})]},e.id)})}):(0,n.jsx)(h.A,{textAlign:"center",py:3,children:(0,n.jsx)(Q.A,{color:"textSecondary",variant:"body1",children:"No reading sessions recorded yet"})}),(0,n.jsx)(h.A,{mt:3,children:(0,n.jsx)(eE.A,{variant:"outlined",fullWidth:!0,onClick:()=>t("/sessions"),sx:{py:1.5},children:"View All Sessions"})})]})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(ek.A,{sx:{height:"100%"},children:(0,n.jsxs)(eC.A,{sx:{p:3},children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,fontWeight:600,children:"Reading Level Distribution"}),Object.keys(b).length>0?(0,n.jsx)(h.A,{children:Object.entries(b).map(e=>{let[t,s]=e;return(0,n.jsxs)(h.A,{mb:2.5,children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,n.jsx)(Q.A,{variant:"body2",fontWeight:500,children:t}),(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:[s," students"]})]}),(0,n.jsx)(eR.A,{variant:"determinate",value:s/x*100,sx:{height:10,borderRadius:5,backgroundColor:"rgba(0, 0, 0, 0.05)","& .MuiLinearProgress-bar":{borderRadius:5}}})]},t)})}):(0,n.jsx)(h.A,{textAlign:"center",py:3,children:(0,n.jsx)(Q.A,{color:"textSecondary",variant:"body1",children:"No reading levels set yet"})})]})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(ek.A,{sx:{height:"100%"},children:(0,n.jsxs)(eC.A,{sx:{p:3},children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,fontWeight:600,children:"Quick Actions"}),(0,n.jsxs)(eI.A,{container:!0,spacing:2,children:[(0,n.jsx)(eI.A,{item:!0,xs:6,children:(0,n.jsx)(eE.A,{variant:"outlined",fullWidth:!0,startIcon:(0,n.jsx)(eu.A,{}),onClick:()=>t("/students?action=new"),sx:{py:1.5,height:"100%"},children:"Add Student"})}),(0,n.jsx)(eI.A,{item:!0,xs:6,children:(0,n.jsx)(eE.A,{variant:"outlined",fullWidth:!0,startIcon:(0,n.jsx)(em.A,{}),onClick:()=>t("/sessions?action=new"),sx:{py:1.5,height:"100%"},children:"Log Session"})}),(0,n.jsx)(eI.A,{item:!0,xs:6,children:(0,n.jsx)(eE.A,{variant:"outlined",fullWidth:!0,startIcon:(0,n.jsx)(eg.A,{}),onClick:()=>t("/books?action=new"),sx:{py:1.5,height:"100%"},children:"Add Book"})}),(0,n.jsx)(eI.A,{item:!0,xs:6,children:(0,n.jsx)(eE.A,{variant:"outlined",fullWidth:!0,startIcon:(0,n.jsx)(eB.A,{}),onClick:()=>t("/recommendations"),sx:{py:1.5,height:"100%"},children:"Get Recommendations"})})]})]})})})]})]})};var eN=s(6976),ez=s(4372),eF=s(9677),eG=s(5976),eM=s(730),e$=s(2253),e_=s(9793),eH=s(6985),eU=s(734),eJ=s(4095),eq=s(9828),eY=s(1792),eK=s(739),eV=s(2475),eZ=s(9318),eQ=s(5028),eX=s(832),e0=s(9827),e1=s(662),e2=s(8228),e4=s(5180),e6=s(8109);let e5=function(e){let{column:t,currentSort:s,onSort:r,align:a="left",disabled:i=!1,children:o}=e,l=(null==s?void 0:s.column)===t,d=l?null==s?void 0:s.direction:null;return(0,n.jsx)(e_.A,{align:a,sortDirection:!!l&&d,sx:{backgroundColor:l?"primary.50":"inherit",fontWeight:l?"bold":"medium",cursor:i?"default":"pointer","&:hover":{backgroundColor:i?"inherit":"grey.50"},userSelect:"none"},onClick:()=>{i||r(t,l?"asc"===d?"desc":null:"asc")},children:(0,n.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",justifyContent:"right"===a?"flex-end":"flex-start"},children:[o,!i&&(0,n.jsx)(e1.A,{active:l,direction:d||"asc",IconComponent:()=>l?"asc"===d?(0,n.jsx)(e4.A,{sx:{fontSize:16}}):"desc"===d?(0,n.jsx)(e6.A,{sx:{fontSize:16}}):(0,n.jsx)(e2.A,{sx:{fontSize:16}}):(0,n.jsx)(e2.A,{sx:{fontSize:16}}),sx:{marginLeft:1,"&.MuiTableSortLabel-active":{color:"primary.main"}}})]})})};function e3(e,t,s){return s&&t?[...e].sort((e,n)=>{var r,a,i,o,l,d,c,h,x;let u,m,p,g,y,j,A,f=e8(e,t),b=e8(n,t);return null==f&&null==b?0:null==f?"asc"===s?-1:1:null==b?"asc"===s?1:-1:e9(f)||e9(b)?(r=f,a=b,i=s,u=r instanceof Date?r:new Date(r),m=a instanceof Date?a:new Date(a),p=u.getTime()-m.getTime(),"asc"===i?p:-p):e7(f)&&e7(b)?(o=f,l=b,d=s,g=parseFloat(o)-parseFloat(l),"asc"===d?g:-g):(c=f,h=b,x=s,y=String(c).toLowerCase(),j=String(h).toLowerCase(),A=y.localeCompare(j),"asc"===x?A:-A)}):e}function e8(e,t){return t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:null,e)}function e9(e){return e instanceof Date||"string"==typeof e&&([/^\d{4}-\d{2}-\d{2}$/,/^\d{2}\/\d{2}\/\d{4}$/,/^\d{2}-\d{2}-\d{4}$/].some(t=>t.test(e))||!isNaN(Date.parse(e)))}function e7(e){return!isNaN(parseFloat(e))&&isFinite(e)}let te=function(){let e=(0,o.Zp)(),{state:t,api:s,setSelectedClassFilter:a}=Y(),{students:i,classes:l,genres:d}=t,[c,x]=(0,r.useState)(""),[u,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(null),[y,j]=(0,r.useState)({open:!1,message:"",severity:"success"}),[A,f]=(0,r.useState)({name:"",classId:"",readingLevel:"",preferences:{favoriteGenreIds:[],likes:[],dislikes:[],readingFormats:[]}}),[b,v]=(0,r.useState)(!1),[S,k]=(0,r.useState)(""),[C,w]=(0,r.useState)(!1),[I,D]=(0,r.useState)(""),L=async(e,n)=>{let{sorting:r}=t;if(s.setSort("students",e,n),i.length>500&&n)try{await s.getStudentsSorted(e,n)}catch(e){console.error("Error sorting students:",e)}},T=(0,r.useMemo)(()=>{let{sorting:e}=t,s=i.filter(e=>{let s=e.name.toLowerCase().includes(c.toLowerCase()),n=!t.selectedClassFilter||e.classId===t.selectedClassFilter;return s&&n});return e.students.column&&e.students.direction&&(i.length>500||(s=e3(s,e.students.column,e.students.direction))),s},[i,c,t.selectedClassFilter,t.sorting.students]),E=async e=>{if(window.confirm("Are you sure you want to delete this student? This action cannot be undone."))try{await s.deleteStudent(e),j({open:!0,message:"Student deleted successfully",severity:"success"})}catch(e){j({open:!0,message:"Failed to delete student",severity:"error"})}},R=async()=>{try{p?(await s.updateStudent(p.id,A),j({open:!0,message:"Student updated successfully",severity:"success"})):(await s.createStudent(A),j({open:!0,message:"Student created successfully",severity:"success"})),m(!1)}catch(e){j({open:!0,message:"Failed to save student",severity:"error"})}},O=()=>{m(!1),g(null)},W=()=>{j({...y,open:!1})},B=()=>{v(!1),k(""),D("")},P=async()=>{if(!S.trim())return void j({open:!0,message:"Please enter student data",severity:"error"});w(!0);try{let e;try{e=JSON.parse(S)}catch{e=N(S)}if(!Array.isArray(e)||0===e.length)return void j({open:!0,message:"No valid student data found",severity:"error"});let t=await s.bulkImportStudents(e),n=t.data.created.length,r=t.data.errors.length;j({open:!0,message:`Successfully imported ${n} students${r>0?`, ${r} errors`:""}`,severity:r>0?"warning":"success"}),B()}catch(e){j({open:!0,message:"Failed to import students",severity:"error"})}finally{w(!1)}},N=e=>{let t=e.trim().split("\n").filter(e=>e.trim()),s=[];for(let e of t){let t=e.trim();t&&s.push({name:t,classId:I||null,readingLevel:null,preferences:{favoriteGenreIds:[],likes:[],dislikes:[],readingFormats:[]}})}return s},z=e=>l.find(t=>t.id===e);return(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h4",children:"Students"}),(0,n.jsxs)(h.A,{display:"flex",gap:2,children:[(0,n.jsx)(eE.A,{variant:"outlined",startIcon:(0,n.jsx)(eb.A,{}),onClick:()=>{v(!0),D("")},children:"Bulk Import"}),(0,n.jsx)(eE.A,{variant:"contained",startIcon:(0,n.jsx)(eb.A,{}),onClick:()=>{g(null),f({name:"",classId:"",readingLevel:"",preferences:{favoriteGenreIds:[],likes:[],dislikes:[],readingFormats:[]}}),m(!0)},children:"Add Student"})]})]}),(0,n.jsx)(ek.A,{sx:{mb:3},children:(0,n.jsx)(eC.A,{children:(0,n.jsx)(eI.A,{container:!0,spacing:2,alignItems:"center",children:(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,placeholder:"Search students...",value:c,onChange:e=>x(e.target.value),InputProps:{startAdornment:(0,n.jsx)(eQ.A,{color:"action",sx:{mr:1}})}})})})})}),(0,n.jsx)(ez.A,{component:eF.A,children:(0,n.jsxs)(eG.A,{children:[(0,n.jsx)(eM.A,{children:(0,n.jsxs)(e$.A,{children:[(0,n.jsx)(e5,{column:"name",currentSort:t.sorting.students,onSort:L,children:"Name"}),(0,n.jsx)(e5,{column:"classId",currentSort:t.sorting.students,onSort:L,children:"Class"}),(0,n.jsx)(e5,{column:"readingLevel",currentSort:t.sorting.students,onSort:L,children:"Reading Level"}),(0,n.jsx)(e5,{column:"lastReadDate",currentSort:t.sorting.students,onSort:L,children:"Last Read"}),(0,n.jsx)(e_.A,{children:"Favorite Genres"}),(0,n.jsx)(e_.A,{align:"right",children:"Actions"})]})}),(0,n.jsx)(eH.A,{children:t.sortingLoading.students?(0,n.jsx)(e$.A,{children:(0,n.jsx)(e_.A,{colSpan:6,align:"center",sx:{py:4},children:(0,n.jsxs)(h.A,{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2,children:[(0,n.jsx)(eU.A,{size:40}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Sorting students..."})]})})}):T.map(t=>{var s;return(0,n.jsxs)(e$.A,{children:[(0,n.jsx)(e_.A,{children:(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",children:[(0,n.jsx)(ew.A,{sx:{bgcolor:"primary.main",mr:2,width:32,height:32},children:(0,n.jsx)(eu.A,{})}),(0,n.jsx)(Q.A,{variant:"body1",fontWeight:"medium",children:t.name})]})}),(0,n.jsx)(e_.A,{children:z(t.classId)?(0,n.jsx)(eD.A,{label:z(t.classId).name,size:"small",color:"secondary",variant:"outlined"}):"-"}),(0,n.jsx)(e_.A,{children:t.readingLevel&&(0,n.jsx)(eD.A,{label:t.readingLevel,size:"small",color:(s=t.readingLevel)&&"Not Set"!==s?s.toLowerCase().includes("beginner")||s.toLowerCase().includes("early")?"success":s.toLowerCase().includes("intermediate")||s.toLowerCase().includes("developing")?"warning":s.toLowerCase().includes("advanced")||s.toLowerCase().includes("fluent")?"primary":"default":"default",variant:"outlined"})}),(0,n.jsx)(e_.A,{children:t.lastReadDate?new Date(t.lastReadDate).toLocaleDateString():"Never"}),(0,n.jsx)(e_.A,{children:(0,n.jsxs)(h.A,{display:"flex",gap:.5,flexWrap:"wrap",children:[t.preferences.favoriteGenreIds.slice(0,3).map(e=>{let t=d.find(t=>t.id===e);return t?(0,n.jsx)(eD.A,{label:t.name,size:"small",variant:"outlined"},e):null}),t.preferences.favoriteGenreIds.length>3&&(0,n.jsx)(eD.A,{label:`+${t.preferences.favoriteGenreIds.length-3} more`,size:"small",variant:"outlined"}),0===t.preferences.favoriteGenreIds.length&&(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"None set"})]})}),(0,n.jsxs)(e_.A,{align:"right",children:[(0,n.jsx)(eE.A,{size:"small",onClick:()=>e(`/students/${t.id}`),sx:{mr:1},children:"View"}),(0,n.jsx)(X.A,{size:"small",onClick:()=>{g(t),f({name:t.name,classId:t.classId||"",readingLevel:t.readingLevel||"",preferences:{...t.preferences}}),m(!0)},children:(0,n.jsx)(eX.A,{})}),(0,n.jsx)(X.A,{size:"small",color:"error",onClick:()=>E(t.id),children:(0,n.jsx)(e0.A,{})})]})]},t.id)})})]})}),0===T.length&&(0,n.jsx)(ek.A,{sx:{textAlign:"center",py:8},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(eu.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No students found"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:c||t.selectedClassFilter?"Try adjusting your search or filter criteria":"Get started by adding your first student"})]})}),(0,n.jsxs)(eJ.A,{open:u,onClose:O,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:p?"Edit Student":"Add New Student"}),(0,n.jsx)(eY.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Student Name",value:A.name,onChange:e=>f({...A,name:e.target.value}),required:!0})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Class"}),(0,n.jsxs)(eo.A,{value:A.classId,onChange:e=>f({...A,classId:e.target.value}),label:"Class",children:[(0,n.jsx)(el.A,{value:"",children:"No Class"}),l.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))]})]})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Reading Level",value:A.readingLevel,onChange:e=>f({...A,readingLevel:e.target.value}),placeholder:"e.g., Beginner, Intermediate, Advanced"})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Favorite Genres"}),(0,n.jsx)(eo.A,{multiple:!0,value:A.preferences.favoriteGenreIds,onChange:e=>f({...A,preferences:{...A.preferences,favoriteGenreIds:e.target.value}}),label:"Favorite Genres",renderValue:e=>(0,n.jsx)(h.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{let t=d.find(t=>t.id===e);return t?(0,n.jsx)(eD.A,{label:t.name,size:"small"},e):null})}),children:d.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))})]})})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:O,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:R,variant:"contained",disabled:!A.name.trim(),children:p?"Update Student":"Add Student"})]})]}),(0,n.jsxs)(eJ.A,{open:b,onClose:B,maxWidth:"md",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:"Bulk Import Students"}),(0,n.jsxs)(eY.A,{children:[(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Import multiple students at once. You can paste a list of names (one per line) or JSON data."}),(0,n.jsx)(eI.A,{container:!0,spacing:2,sx:{mb:2},children:(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Default Class (Optional)"}),(0,n.jsxs)(eo.A,{value:I,onChange:e=>D(e.target.value),label:"Default Class (Optional)",children:[(0,n.jsx)(el.A,{value:"",children:"No Default Class"}),l.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))]})]})})}),(0,n.jsx)(eN.A,{fullWidth:!0,multiline:!0,rows:10,label:"Student Data",value:S,onChange:e=>k(e.target.value),placeholder:"Enter student names (one per line) or JSON data...",sx:{mb:2}}),(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:[(0,n.jsx)("strong",{children:"Simple Format:"})," One name per line",(0,n.jsx)("br",{}),"John Doe",(0,n.jsx)("br",{}),"Jane Smith",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("strong",{children:"JSON Format:"}),(0,n.jsx)("br",{}),"[",'"name": "John Doe", "classId": "class-id", "readingLevel": "Intermediate"',"]"]})]}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:B,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:P,variant:"contained",disabled:C||!S.trim(),children:C?"Importing...":"Import Students"})]})]}),(0,n.jsx)(eV.A,{open:y.open,autoHideDuration:4e3,onClose:W,children:(0,n.jsx)(eZ.A,{onClose:W,severity:y.severity,children:y.message})})]})};var tt=s(6708),ts=s(6796),tn=s(7441);let tr=function(){let{id:e}=(0,o.g)(),t=(0,o.Zp)(),{state:s,api:a}=Y(),[i,l]=(0,r.useState)(null),[d,c]=(0,r.useState)([]),[x,u]=(0,r.useState)(!0);console.log("StudentDetailPage - Component rendered with ID:",e),(0,r.useEffect)(()=>{if(console.log("StudentDetailPage - Looking for student with ID:",e),console.log("StudentDetailPage - Available students:",s.students.length),console.log("StudentDetailPage - Available sessions:",s.sessions.length),0===s.students.length)return void console.log("StudentDetailPage - No students loaded yet, waiting...");let t=s.students.find(t=>t.id===e);if(t)if(console.log("StudentDetailPage - Found student:",t),l(t),s.sessions.length>0){let t=s.sessions.filter(t=>t.studentId===e);console.log("StudentDetailPage - Found sessions:",t.length),c(t.sort((e,t)=>new Date(t.date)-new Date(e.date)))}else console.log("StudentDetailPage - No sessions available yet"),c([]);else console.log("StudentDetailPage - Student not found with ID:",e),console.log("StudentDetailPage - Available student IDs:",s.students.map(e=>e.id));u(!1)},[e,s.students,s.sessions]);let m=e=>new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});if(x)return(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",gap:2,mb:3,children:[(0,n.jsx)(X.A,{onClick:()=>t("/students"),color:"primary",children:(0,n.jsx)(ts.A,{})}),(0,n.jsx)(Q.A,{variant:"h4",children:"Student Details"})]}),(0,n.jsx)(eR.A,{}),(0,n.jsx)(Q.A,{variant:"h6",align:"center",sx:{mt:4},children:"Loading student details..."}),(0,n.jsxs)(Q.A,{variant:"body2",align:"center",sx:{mt:2,color:"text.secondary"},children:["Student ID: ",e]})]});if(!i)return(0,n.jsxs)(h.A,{children:[(0,n.jsx)(eZ.A,{severity:"error",sx:{mb:2},children:"Student not found"}),(0,n.jsx)(eE.A,{startIcon:(0,n.jsx)(ts.A,{}),onClick:()=>t("/students"),variant:"outlined",children:"Back to Students"})]});let p=(()=>{if(0===d.length)return 0;let e=[...d].sort((e,t)=>new Date(t.date)-new Date(e.date)),t=0,s=new Date;for(let n of e){let e=new Date(n.date);if(Math.ceil(Math.abs(s-e)/864e5)<=t+1)t++,s=e;else break}return t})(),g=new Set(d.map(e=>e.bookId)).size;return(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",gap:2,mb:3,children:[(0,n.jsx)(X.A,{onClick:()=>t("/students"),color:"primary",children:(0,n.jsx)(ts.A,{})}),(0,n.jsx)(Q.A,{variant:"h4",children:"Student Details"})]}),(0,n.jsxs)(eI.A,{container:!0,spacing:3,children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:4,children:(0,n.jsx)(ek.A,{children:(0,n.jsx)(eC.A,{children:(0,n.jsxs)(h.A,{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",children:[(0,n.jsx)(ew.A,{sx:{width:80,height:80,mb:2,bgcolor:"primary.main"},children:(0,n.jsx)(eO.A,{sx:{fontSize:40}})}),(0,n.jsx)(Q.A,{variant:"h5",gutterBottom:!0,children:i.name}),(0,n.jsxs)(h.A,{display:"flex",gap:1,mb:2,flexWrap:"wrap",justifyContent:"center",children:[(0,n.jsx)(eD.A,{label:`Level: ${i.readingLevel||"Not Set"}`,color:{Beginner:"success",Intermediate:"warning",Advanced:"primary","Not Set":"default"}[i.readingLevel]||"default",variant:"outlined"}),(0,n.jsx)(eD.A,{label:`Class: ${i.className||"Not Assigned"}`,variant:"outlined"})]}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",mb:2,children:i.email||"No email provided"}),(0,n.jsx)(eE.A,{variant:"outlined",startIcon:(0,n.jsx)(eX.A,{}),onClick:()=>t(`/students?action=edit&id=${i.id}`),fullWidth:!0,children:"Edit Student"})]})})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:8,children:(0,n.jsx)(ek.A,{children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,children:"Reading Statistics"}),(0,n.jsxs)(eI.A,{container:!0,spacing:3,children:[(0,n.jsx)(eI.A,{item:!0,xs:6,sm:3,children:(0,n.jsxs)(h.A,{textAlign:"center",children:[(0,n.jsx)(Q.A,{variant:"h3",color:"primary.main",children:d.length}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Total Sessions"})]})}),(0,n.jsx)(eI.A,{item:!0,xs:6,sm:3,children:(0,n.jsxs)(h.A,{textAlign:"center",children:[(0,n.jsx)(Q.A,{variant:"h3",color:"success.main",children:g}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Books Read"})]})}),(0,n.jsx)(eI.A,{item:!0,xs:6,sm:3,children:(0,n.jsxs)(h.A,{textAlign:"center",children:[(0,n.jsx)(Q.A,{variant:"h3",color:"warning.main",children:p}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Day Streak"})]})}),(0,n.jsx)(eI.A,{item:!0,xs:6,sm:3,children:(0,n.jsxs)(h.A,{textAlign:"center",children:[(0,n.jsx)(Q.A,{variant:"h3",color:"info.main",children:i.lastReadDate?m(i.lastReadDate):"Never"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Last Read"})]})})]})]})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(ek.A,{children:(0,n.jsxs)(eC.A,{children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",gap:2,mb:2,children:[(0,n.jsx)(em.A,{color:"primary"}),(0,n.jsx)(Q.A,{variant:"h6",children:"Recent Reading Sessions"}),(0,n.jsx)(eD.A,{label:`${d.length} sessions`,color:"primary",size:"small"})]}),d.length>0?(0,n.jsxs)(ee.A,{children:[d.slice(0,10).map((e,t)=>(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)(et.Ay,{children:[(0,n.jsx)(eL.A,{children:(0,n.jsx)(ew.A,{sx:{bgcolor:"school"===e.environment?"primary":"secondary"},children:"school"===e.environment?"S":"H"})}),(0,n.jsx)(er.A,{primary:(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",gap:1,children:[(0,n.jsx)(Q.A,{variant:"subtitle1",children:e.bookTitle}),(0,n.jsx)(eD.A,{label:e.assessment,size:"small",color:"Excellent"===e.assessment?"success":"Good"===e.assessment?"primary":"Needs Improvement"===e.assessment?"warning":"default"})]}),secondary:(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:["by ",e.author]}),(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",gap:1,mt:1,children:[(0,n.jsx)(tn.A,{fontSize:"small",color:"action"}),(0,n.jsxs)(Q.A,{variant:"caption",color:"textSecondary",children:[m(e.date)," • ",e.environment]})]}),e.notes&&(0,n.jsxs)(Q.A,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:['"',e.notes,'"']})]})})]}),t<d.slice(0,10).length-1&&(0,n.jsx)(tt.A,{})]},e.id)),d.length>10&&(0,n.jsx)(et.Ay,{children:(0,n.jsx)(er.A,{primary:`... and ${d.length-10} more sessions`,primaryTypographyProps:{color:"textSecondary"}})})]}):(0,n.jsxs)(h.A,{textAlign:"center",py:4,children:[(0,n.jsx)(em.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{color:"textSecondary",children:"No reading sessions recorded yet"})]})]})})})]})]})};var ta=s(1120),ti=s(7083),to=s(9277),tl=s(2595),td=s(631),tc=s(9824),th=s(9654);let tx=function(){(0,o.Zp)();let{state:e,api:t}=Y(),{sessions:s,students:a,books:i}=e,[l,d]=(0,r.useState)(""),[c,x]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[p,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null),[A,f]=(0,r.useState)({open:!1,message:"",severity:"success"}),[b,v]=(0,r.useState)({date:new Date().toISOString().split("T")[0],studentId:"",bookId:"",bookTitle:"",author:"",assessment:"",notes:"",environment:"school",bookPreference:""}),S=async(n,r)=>{let{sorting:a}=e;if(t.setSort("sessions",n,r),s.length>500&&r)try{await t.getSessionsSorted(n,r)}catch(e){console.error("Error sorting sessions:",e)}},k=(0,r.useMemo)(()=>{let{sorting:t}=e,n=s.filter(t=>{var s;let n=""===l||t.bookTitle.toLowerCase().includes(l.toLowerCase())||(null==(s=a.find(e=>e.id===t.studentId))?void 0:s.name.toLowerCase().includes(l.toLowerCase())),r=!c||t.studentId===c,i=a.find(e=>e.id===t.studentId),o=!e.selectedClassFilter||(null==i?void 0:i.classId)===e.selectedClassFilter,d=!u||t.environment===u;return n&&r&&d&&o});return t.sessions.column&&t.sessions.direction&&(s.length>500||(n=e3(n,t.sessions.column,t.sessions.direction))),n},[s,l,c,u,e.selectedClassFilter,a,e.sorting.sessions]),C=async e=>{if(window.confirm("Are you sure you want to delete this reading session?"))try{await t.deleteSession(e),f({open:!0,message:"Session deleted successfully",severity:"success"})}catch(e){f({open:!0,message:"Failed to delete session",severity:"error"})}},w=async()=>{try{let e={date:b.date,studentId:b.studentId,assessment:b.assessment,notes:b.notes,environment:b.environment,bookPreference:b.bookPreference||null};b.bookId?(e.bookId=b.bookId,e.bookTitle=b.bookTitle,e.author=b.author):b.bookTitle&&b.author&&(e.bookTitle=b.bookTitle,e.author=b.author),y?(await t.updateSession(y.id,e),f({open:!0,message:"Session updated successfully",severity:"success"})):(await t.createSession(e),f({open:!0,message:"Session created successfully",severity:"success"})),g(!1)}catch(e){f({open:!0,message:"Failed to save session",severity:"error"})}},I=()=>{g(!1),j(null)},D=()=>{f({...A,open:!1})},L=e=>"school"===e?"primary":"secondary";return(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h4",children:"Reading Sessions"}),(0,n.jsx)(eE.A,{variant:"contained",startIcon:(0,n.jsx)(eb.A,{}),onClick:()=>{j(null),v({date:new Date().toISOString().split("T")[0],studentId:"",bookId:"",bookTitle:"",author:"",assessment:"",notes:"",environment:"school",bookPreference:""}),g(!0)},children:"Log Session"})]}),(0,n.jsx)(ek.A,{sx:{mb:3},children:(0,n.jsx)(eC.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,alignItems:"center",children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:4,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Search sessions",value:l,onChange:e=>d(e.target.value),InputProps:{startAdornment:(0,n.jsx)(eQ.A,{color:"action",sx:{mr:1}})}})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:4,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Filter by Student"}),(0,n.jsxs)(eo.A,{value:c,onChange:e=>x(e.target.value),label:"Filter by Student",children:[(0,n.jsx)(el.A,{value:"",children:"All Students"}),a.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))]})]})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:4,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Environment"}),(0,n.jsxs)(eo.A,{value:u,onChange:e=>m(e.target.value),label:"Environment",children:[(0,n.jsx)(el.A,{value:"",children:"All Environments"}),(0,n.jsx)(el.A,{value:"school",children:"School"}),(0,n.jsx)(el.A,{value:"home",children:"Home"})]})]})})]})})}),(0,n.jsx)(ez.A,{component:eF.A,children:(0,n.jsxs)(eG.A,{children:[(0,n.jsx)(eM.A,{children:(0,n.jsxs)(e$.A,{children:[(0,n.jsx)(e5,{column:"bookTitle",currentSort:e.sorting.sessions,onSort:S,children:"Book"}),(0,n.jsx)(e5,{column:"studentId",currentSort:e.sorting.sessions,onSort:S,children:"Student"}),(0,n.jsx)(e5,{column:"date",currentSort:e.sorting.sessions,onSort:S,children:"Date"}),(0,n.jsx)(e5,{column:"environment",currentSort:e.sorting.sessions,onSort:S,children:"Environment"}),(0,n.jsx)(e5,{column:"assessment",currentSort:e.sorting.sessions,onSort:S,children:"Assessment"}),(0,n.jsx)(e5,{column:"bookPreference",currentSort:e.sorting.sessions,onSort:S,children:"Rating"}),(0,n.jsx)(e_.A,{align:"right",children:"Actions"})]})}),(0,n.jsx)(eH.A,{children:e.sortingLoading.sessions?(0,n.jsx)(e$.A,{children:(0,n.jsx)(e_.A,{colSpan:7,align:"center",sx:{py:4},children:(0,n.jsxs)(h.A,{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2,children:[(0,n.jsx)(eU.A,{size:40}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Sorting sessions..."})]})})}):k.map(e=>{var t;let s;return(0,n.jsxs)(e$.A,{children:[(0,n.jsx)(e_.A,{children:(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",children:[(0,n.jsx)(ew.A,{sx:{bgcolor:L(e.environment),mr:2,width:32,height:32},children:"school"===e.environment?(0,n.jsx)(eu.A,{}):(0,n.jsx)(tl.A,{})}),(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"body1",fontWeight:"medium",children:e.bookTitle}),(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:["by ",e.author]})]})]})}),(0,n.jsx)(e_.A,{children:(t=e.studentId,(s=a.find(e=>e.id===t))?s.name:"Unknown Student")}),(0,n.jsx)(e_.A,{children:new Date(e.date).toLocaleDateString()}),(0,n.jsx)(e_.A,{children:(0,n.jsx)(eD.A,{label:e.environment,color:L(e.environment),variant:"outlined",size:"small"})}),(0,n.jsx)(e_.A,{children:(0,n.jsxs)(Q.A,{variant:"body2",children:[e.assessment,e.notes&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)(Q.A,{variant:"caption",color:"textSecondary",children:e.notes})]})]})}),(0,n.jsx)(e_.A,{children:e.bookPreference&&(0,n.jsxs)(n.Fragment,{children:["liked"===e.bookPreference&&(0,n.jsx)(eD.A,{icon:(0,n.jsx)(td.A,{}),label:"Liked",color:"success",variant:"outlined",size:"small"}),"meh"===e.bookPreference&&(0,n.jsx)(eD.A,{icon:(0,n.jsx)(tc.A,{}),label:"Okay",color:"warning",variant:"outlined",size:"small"}),"disliked"===e.bookPreference&&(0,n.jsx)(eD.A,{icon:(0,n.jsx)(th.A,{}),label:"Disliked",color:"error",variant:"outlined",size:"small"})]})}),(0,n.jsxs)(e_.A,{align:"right",children:[(0,n.jsx)(X.A,{onClick:()=>{j(e),v({date:e.date,studentId:e.studentId,bookId:e.bookId||"",bookTitle:e.bookTitle,author:e.author,assessment:e.assessment,notes:e.notes||"",environment:e.environment,bookPreference:e.bookPreference||""}),g(!0)},children:(0,n.jsx)(eX.A,{})}),(0,n.jsx)(X.A,{color:"error",onClick:()=>C(e.id),children:(0,n.jsx)(e0.A,{})})]})]},e.id)})})]})}),0===k.length&&(0,n.jsx)(ek.A,{sx:{textAlign:"center",py:8},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(em.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No reading sessions found"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:e.selectedClassFilter||l||c||u?"Try adjusting your search or filter criteria":"Start tracking reading progress by logging your first session"})]})}),(0,n.jsxs)(eJ.A,{open:p,onClose:I,maxWidth:"md",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:y?"Edit Reading Session":"Log Reading Session"}),(0,n.jsx)(eY.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,type:"date",label:"Date",value:b.date,onChange:e=>v({...b,date:e.target.value}),InputLabelProps:{shrink:!0},required:!0})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsxs)(ea.A,{fullWidth:!0,required:!0,children:[(0,n.jsx)(ei.A,{children:"Student"}),(0,n.jsx)(eo.A,{value:b.studentId,onChange:e=>v({...b,studentId:e.target.value}),label:"Student",children:a.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))})]})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(ta.A,{options:i,getOptionLabel:e=>`${e.title} by ${e.author}`,renderInput:e=>(0,n.jsx)(eN.A,{...e,label:"Select Book (optional)",sx:{"& .MuiInputBase-root":{fontSize:"1.4rem",minHeight:"64px",minWidth:"400px"},"& .MuiInputLabel-root":{fontSize:"1.2rem"}}}),onChange:(e,t)=>{t&&v({...b,bookId:t.id,bookTitle:t.title,author:t.author})},value:i.find(e=>e.id===b.bookId)||null,sx:{"& .MuiAutocomplete-popupIndicator":{fontSize:"2rem"},"& .MuiAutocomplete-option":{fontSize:"1.4rem",minHeight:"48px",padding:"12px 16px"}},ListboxProps:{sx:{maxHeight:"300px","& .MuiAutocomplete-option":{fontSize:"1.4rem",minHeight:"48px"}}}})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Book Title",value:b.bookTitle,onChange:e=>v({...b,bookTitle:e.target.value}),placeholder:"Enter book title if not in list"})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Author",value:b.author,onChange:e=>v({...b,author:e.target.value}),placeholder:"Enter author name"})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,multiline:!0,rows:3,label:"Assessment",value:b.assessment,onChange:e=>v({...b,assessment:e.target.value}),placeholder:"Describe how the reading session went...",required:!0})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,multiline:!0,rows:2,label:"Notes (optional)",value:b.notes,onChange:e=>v({...b,notes:e.target.value}),placeholder:"Any additional notes..."})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(ea.A,{component:"fieldset",children:(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",children:[(0,n.jsx)(Q.A,{sx:{mr:2},children:"Environment:"}),(0,n.jsx)(ti.A,{control:(0,n.jsx)(to.A,{checked:"home"===b.environment,onChange:e=>v({...b,environment:e.target.checked?"home":"school"})}),label:"home"===b.environment?"Home":"School"})]})})}),(0,n.jsxs)(eI.A,{item:!0,xs:12,children:[(0,n.jsx)(Q.A,{variant:"subtitle2",gutterBottom:!0,children:"How did the child feel about this book? (Optional)"}),(0,n.jsxs)(h.A,{display:"flex",gap:2,justifyContent:"center",children:[(0,n.jsx)(eE.A,{variant:"liked"===b.bookPreference?"contained":"outlined",color:"success",startIcon:(0,n.jsx)(td.A,{}),onClick:()=>v({...b,bookPreference:"liked"===b.bookPreference?"":"liked"}),sx:{minWidth:120},children:"Liked"}),(0,n.jsx)(eE.A,{variant:"meh"===b.bookPreference?"contained":"outlined",color:"warning",startIcon:(0,n.jsx)(tc.A,{}),onClick:()=>v({...b,bookPreference:"meh"===b.bookPreference?"":"meh"}),sx:{minWidth:120},children:"Okay"}),(0,n.jsx)(eE.A,{variant:"disliked"===b.bookPreference?"contained":"outlined",color:"error",startIcon:(0,n.jsx)(th.A,{}),onClick:()=>v({...b,bookPreference:"disliked"===b.bookPreference?"":"disliked"}),sx:{minWidth:120},children:"Disliked"})]})]})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:I,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:w,variant:"contained",disabled:!b.studentId||!b.assessment,children:y?"Update":"Log Session"})]})]}),(0,n.jsx)(eV.A,{open:A.open,autoHideDuration:4e3,onClose:D,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,n.jsx)(eZ.A,{onClose:D,severity:A.severity,children:A.message})})]})};var tu=s(8559),tm=s(2734);let tp=function(){let{state:e,api:t}=Y(),{books:s,genres:a}=e;console.log("BooksPage rendered with:",{booksCount:s.length,genresCount:a.length});let[i,o]=(0,r.useState)(""),[l,d]=(0,r.useState)(""),[c,x]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[p,g]=(0,r.useState)({open:!1,message:"",severity:"success"}),[y,j]=(0,r.useState)(!1),[A,f]=(0,r.useState)(null),[b,v]=(0,r.useState)(!1),[S,k]=(0,r.useState)(!1),[C,w]=(0,r.useState)({title:"",author:"",genreIds:[],readingLevel:"",ageRange:""}),[I,D]=(0,r.useState)(!1),[L,T]=(0,r.useState)(""),[E,R]=(0,r.useState)([]),[O,W]=(0,r.useState)(!1),[B,P]=(0,r.useState)(null),[N,z]=(0,r.useState)(!1),[F,G]=(0,r.useState)(!1),[M,$]=(0,r.useState)([]),[_,H]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{try{await Promise.all([t.getBooks(),t.getGenres()])}catch(e){console.error("Error loading books data:",e),g({open:!0,message:"Failed to load books data",severity:"error"})}};0===s.length&&0===a.length&&e()},[t,s.length,a.length]);let U=async(n,r)=>{let{sorting:a}=e;if(t.setSort("books",n,r),s.length>500&&r)try{await t.getBooksSorted(n,r)}catch(e){console.error("Error sorting books:",e)}},J=(0,r.useMemo)(()=>{let{sorting:t}=e,n=s.filter(e=>{let t=e.title.toLowerCase().includes(i.toLowerCase())||e.author&&e.author.toLowerCase().includes(i.toLowerCase()),s=!l||e.genreIds.includes(l);return t&&s});return t.books.column&&t.books.direction&&(s.length>500||(n=e3(n,t.books.column,t.books.direction))),n},[s,i,l,e.sorting.books]),q=async e=>{if(window.confirm("Are you sure you want to delete this book? This action cannot be undone."))try{await t.deleteBook(e),g({open:!0,message:"Book deleted successfully",severity:"success"})}catch(e){g({open:!0,message:"Failed to delete book",severity:"error"})}},K=async()=>{try{u?(await t.updateBook(u.id,C),g({open:!0,message:"Book updated successfully",severity:"success"})):(await t.createBook(C),g({open:!0,message:"Book created successfully",severity:"success"})),x(!1)}catch(e){g({open:!0,message:"Failed to save book",severity:"error"})}},V=()=>{x(!1),m(null)},Z=()=>{g({...p,open:!1})},es=()=>{D(!1),T(""),R([])},en=async()=>{if(L.trim()){W(!0);try{let t=await fetch(`/api/books/search/external?q=${encodeURIComponent(L.trim())}&limit=20`),s=await t.json();if(t.ok)R(s.data);else{var e;g({open:!0,message:(null==(e=s.error)?void 0:e.message)||"Search failed",severity:"error"})}}catch(e){g({open:!0,message:"Failed to search external library",severity:"error"})}finally{W(!1)}}},ed=async e=>{try{let s=await fetch(`/api/books/external/${e.externalId}`),n=await s.json();if(s.ok)P({...e,...n.data}),z(!0);else{var t;g({open:!0,message:(null==(t=n.error)?void 0:t.message)||"Failed to load book details",severity:"error"})}}catch(e){g({open:!0,message:"Failed to load book details",severity:"error"})}},ec=async e=>{try{let n=await fetch("/api/books/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({externalId:e.externalId,genreIds:[],readingLevel:"",ageRange:""})}),r=await n.json();if(n.ok)g({open:!0,message:"Book imported successfully",severity:"success"}),z(!1),await t.getBooks();else{var s;g({open:!0,message:(null==(s=r.error)?void 0:s.message)||"Failed to import book",severity:"error"})}}catch(e){g({open:!0,message:"Failed to import book",severity:"error"})}},eh=async()=>{if(C.title.trim()){G(!0),H(!0),$([]);try{let e=await fetch(`/api/books/search/external?q=${encodeURIComponent(C.title.trim())}&limit=10`),t=await e.json();if(e.ok){let e=[],s=new Set;t.data.forEach(t=>{t.author&&!s.has(t.author.toLowerCase())&&(s.add(t.author.toLowerCase()),e.push({name:t.author,bookTitle:t.title,source:"openlibrary"}))}),$(e)}else g({open:!0,message:"Failed to search for authors",severity:"error"}),G(!1)}catch(e){g({open:!0,message:"Failed to search for authors",severity:"error"}),G(!1)}finally{H(!1)}}},ex=()=>{G(!1),$([])},eu=()=>{j(!1),f(null)},em=async()=>{if(!A)return void g({open:!0,message:"Please select a file to import",severity:"error"});v(!0);try{let s=await A.text(),n=JSON.parse(s);if(!Array.isArray(n))return void g({open:!0,message:"Invalid file format. Expected an array of books.",severity:"error"});let r=await fetch("/api/books/batch-import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),a=await r.json();if(r.ok)g({open:!0,message:a.message,severity:"success"}),eu(),await t.getBooks();else{var e;g({open:!0,message:(null==(e=a.error)?void 0:e.message)||"Failed to import books",severity:"error"})}}catch(e){console.error("Import error:",e),g({open:!0,message:"Failed to import books. Please check the file format.",severity:"error"})}finally{v(!1)}},eg=async()=>{k(!0);try{let e=await fetch("/api/books/export"),t=await e.json();if(e.ok){let e=JSON.stringify(t,null,2),s=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=`books_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),g({open:!0,message:"Books exported successfully",severity:"success"})}else g({open:!0,message:"Failed to export books",severity:"error"})}catch(e){console.error("Export error:",e),g({open:!0,message:"Failed to export books",severity:"error"})}finally{k(!1)}};return e.loading&&0===s.length?(0,n.jsx)(h.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,n.jsx)(Q.A,{children:"Loading books..."})}):e.error&&0===s.length?(0,n.jsx)(h.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,n.jsxs)(h.A,{textAlign:"center",children:[(0,n.jsx)(Q.A,{variant:"h6",color:"error",gutterBottom:!0,children:"Error Loading Books"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:e.error}),(0,n.jsx)(eE.A,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]})}):(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h4",children:"Books"}),(0,n.jsxs)(h.A,{display:"flex",gap:2,children:[(0,n.jsx)(eE.A,{variant:"outlined",startIcon:(0,n.jsx)(tu.A,{}),onClick:()=>{j(!0)},disabled:b,children:"Import Books"}),(0,n.jsx)(eE.A,{variant:"outlined",startIcon:(0,n.jsx)(tm.A,{}),onClick:eg,disabled:S,children:S?"Exporting...":"Export Books"}),(0,n.jsx)(eE.A,{variant:"outlined",startIcon:(0,n.jsx)(eQ.A,{}),onClick:()=>{D(!0),T(""),R([])},children:"Search Library"}),(0,n.jsx)(eE.A,{variant:"contained",startIcon:(0,n.jsx)(eb.A,{}),onClick:()=>{m(null),w({title:"",author:"",genreIds:[],readingLevel:"",ageRange:""}),x(!0)},children:"Add Book"})]})]}),(0,n.jsx)(ek.A,{sx:{mb:3},children:(0,n.jsx)(eC.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,alignItems:"center",children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Search books",value:i,onChange:e=>o(e.target.value),InputProps:{startAdornment:(0,n.jsx)(eQ.A,{color:"action",sx:{mr:1}})}})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Filter by Genre"}),(0,n.jsxs)(eo.A,{value:l,onChange:e=>d(e.target.value),label:"Filter by Genre",children:[(0,n.jsx)(el.A,{value:"",children:"All Genres"}),a.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))]})]})})]})})}),(0,n.jsx)(ez.A,{component:eF.A,children:(0,n.jsxs)(eG.A,{children:[(0,n.jsx)(eM.A,{children:(0,n.jsxs)(e$.A,{children:[(0,n.jsx)(e5,{column:"title",currentSort:e.sorting.books,onSort:U,children:"Title"}),(0,n.jsx)(e5,{column:"author",currentSort:e.sorting.books,onSort:U,children:"Author"}),(0,n.jsx)(e5,{column:"readingLevel",currentSort:e.sorting.books,onSort:U,children:"Level"}),(0,n.jsx)(e5,{column:"ageRange",currentSort:e.sorting.books,onSort:U,children:"Age Range"}),(0,n.jsx)(e_.A,{children:"Genres"}),(0,n.jsx)(e_.A,{align:"right",children:"Actions"})]})}),(0,n.jsx)(eH.A,{children:e.sortingLoading.books?(0,n.jsx)(e$.A,{children:(0,n.jsx)(e_.A,{colSpan:6,align:"center",sx:{py:4},children:(0,n.jsxs)(h.A,{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:2,children:[(0,n.jsx)(eU.A,{size:40}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Sorting books..."})]})})}):J.map(e=>{let t;return(0,n.jsxs)(e$.A,{children:[(0,n.jsx)(e_.A,{children:(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",children:[e.coverImage?(0,n.jsx)("img",{src:e.coverImage,alt:`${e.title} cover`,style:{width:40,height:56,objectFit:"cover",borderRadius:4,marginRight:12,border:"1px solid #e0e0e0"}}):(0,n.jsx)(ep.A,{sx:{fontSize:32,color:"primary.main",mr:1}}),(0,n.jsx)(Q.A,{variant:"body1",fontWeight:"medium",children:e.title})]})}),(0,n.jsx)(e_.A,{children:e.author||"-"}),(0,n.jsx)(e_.A,{children:e.readingLevel&&(0,n.jsx)(eD.A,{label:e.readingLevel,size:"small",color:"primary",variant:"outlined"})}),(0,n.jsx)(e_.A,{children:e.ageRange&&(0,n.jsx)(eD.A,{label:e.ageRange,size:"small",color:"secondary",variant:"outlined"})}),(0,n.jsx)(e_.A,{children:(0,n.jsx)(h.A,{display:"flex",gap:.5,flexWrap:"wrap",children:(t=e.genreIds,a.filter(e=>t.includes(e.id))).map(e=>(0,n.jsx)(eD.A,{label:e.name,size:"small",variant:"outlined"},e.id))})}),(0,n.jsxs)(e_.A,{align:"right",children:[(0,n.jsx)(X.A,{onClick:()=>{m(e),w({title:e.title,author:e.author,genreIds:e.genreIds||[],readingLevel:e.readingLevel||"",ageRange:e.ageRange||""}),x(!0)},children:(0,n.jsx)(eX.A,{})}),(0,n.jsx)(X.A,{color:"error",onClick:()=>q(e.id),children:(0,n.jsx)(e0.A,{})})]})]},e.id)})})]})}),0===J.length&&(0,n.jsx)(ek.A,{sx:{textAlign:"center",py:8},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(ep.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No books found"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:i||l?"Try adjusting your search or filter criteria":"Start building your library by adding your first book"})]})}),(0,n.jsxs)(eJ.A,{open:c,onClose:V,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:u?"Edit Book":"Add New Book"}),(0,n.jsx)(eY.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Book Title",value:C.title,onChange:e=>w({...C,title:e.target.value}),required:!0})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsxs)(h.A,{display:"flex",gap:1,children:[(0,n.jsx)(eN.A,{fullWidth:!0,label:"Author (optional)",value:C.author,onChange:e=>w({...C,author:e.target.value})}),(0,n.jsx)(eE.A,{variant:"outlined",onClick:eh,disabled:!C.title.trim(),sx:{minWidth:"auto",px:2},children:(0,n.jsx)(eQ.A,{})})]})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Genres"}),(0,n.jsx)(eo.A,{multiple:!0,value:C.genreIds,onChange:e=>w({...C,genreIds:e.target.value}),label:"Genres",renderValue:e=>(0,n.jsx)(h.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{let t=a.find(t=>t.id===e);return t?(0,n.jsx)(eD.A,{label:t.name,size:"small"},e):null})}),children:a.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))})]})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Reading Level",value:C.readingLevel,onChange:e=>w({...C,readingLevel:e.target.value}),placeholder:"e.g., Beginner, Intermediate, Advanced"})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Age Range",value:C.ageRange,onChange:e=>w({...C,ageRange:e.target.value}),placeholder:"e.g., 5-7 years, 8-10 years"})})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:V,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:K,variant:"contained",disabled:!C.title.trim(),children:u?"Update":"Add Book"})]})]}),(0,n.jsxs)(eJ.A,{open:I,onClose:es,maxWidth:"md",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:"Search External Library"}),(0,n.jsxs)(eY.A,{children:[(0,n.jsxs)(h.A,{sx:{mb:3,display:"flex",gap:1},children:[(0,n.jsx)(eN.A,{fullWidth:!0,label:"Search for books by title or author",value:L,onChange:e=>T(e.target.value),onKeyPress:e=>"Enter"===e.key&&en(),placeholder:"e.g., Harry Potter, J.K. Rowling"}),(0,n.jsx)(eE.A,{variant:"contained",onClick:en,disabled:O||!L.trim(),children:O?"Searching...":"Search"})]}),E.length>0&&(0,n.jsx)(ee.A,{sx:{maxHeight:400,overflow:"auto"},children:E.map((e,t)=>(0,n.jsx)(et.Ay,{divider:!0,children:(0,n.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.coverImage&&(0,n.jsx)("img",{src:e.coverImage,alt:e.title,style:{width:50,height:70,objectFit:"cover",marginRight:16}}),(0,n.jsxs)(h.A,{sx:{flexGrow:1},children:[(0,n.jsx)(Q.A,{variant:"subtitle1",gutterBottom:!0,children:e.title}),(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["by ",e.author]}),e.firstPublishYear&&(0,n.jsxs)(Q.A,{variant:"caption",color:"textSecondary",children:["First published: ",e.firstPublishYear]})]}),(0,n.jsxs)(h.A,{sx:{display:"flex",gap:1},children:[(0,n.jsx)(eE.A,{size:"small",variant:"contained",onClick:()=>ec(e),children:"Add to Library"}),(0,n.jsx)(eE.A,{size:"small",onClick:()=>ed(e),children:"Preview"})]})]})},t))})]}),(0,n.jsx)(eK.A,{children:(0,n.jsx)(eE.A,{onClick:es,children:"Close"})})]}),(0,n.jsxs)(eJ.A,{open:N,onClose:()=>z(!1),maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:"Book Preview"}),(0,n.jsx)(eY.A,{children:B&&(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{sx:{display:"flex",gap:2,mb:3},children:[B.coverImage&&(0,n.jsx)("img",{src:B.coverImage,alt:B.title,style:{width:120,height:160,objectFit:"cover"}}),(0,n.jsxs)(h.A,{sx:{flexGrow:1},children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,children:B.title}),(0,n.jsxs)(Q.A,{variant:"subtitle1",color:"textSecondary",gutterBottom:!0,children:["by ",B.author]}),B.firstPublishYear&&(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:["First published: ",B.firstPublishYear]}),B.pageCount&&(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:["Pages: ",B.pageCount]})]})]}),B.description&&(0,n.jsxs)(h.A,{sx:{mb:3},children:[(0,n.jsx)(Q.A,{variant:"subtitle2",gutterBottom:!0,children:"Description"}),(0,n.jsx)(Q.A,{variant:"body2",children:B.description})]}),B.subjects&&B.subjects.length>0&&(0,n.jsxs)(h.A,{sx:{mb:3},children:[(0,n.jsx)(Q.A,{variant:"subtitle2",gutterBottom:!0,children:"Subjects"}),(0,n.jsx)(h.A,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:B.subjects.slice(0,8).map((e,t)=>(0,n.jsx)(eD.A,{label:e,size:"small",variant:"outlined"},t))})]}),B.authorBio&&(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"subtitle2",gutterBottom:!0,children:"About the Author"}),(0,n.jsx)(Q.A,{variant:"body2",children:B.authorBio})]})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:()=>z(!1),children:"Close"}),(0,n.jsx)(eE.A,{variant:"contained",onClick:()=>ec(B),children:"Import to Library"})]})]}),(0,n.jsxs)(eJ.A,{open:F,onClose:ex,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:"Select Author"}),(0,n.jsxs)(eY.A,{children:[(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,sx:{mb:2},children:['Found potential authors for "',C.title,'":']}),_?(0,n.jsx)(h.A,{display:"flex",justifyContent:"center",p:3,children:(0,n.jsx)(Q.A,{children:"Searching for authors..."})}):M.length>0?(0,n.jsx)(ee.A,{children:M.map((e,t)=>(0,n.jsxs)(et.Ay,{divider:!0,children:[(0,n.jsx)(er.A,{primary:e.name,secondary:`From: ${e.bookTitle}`}),(0,n.jsx)(eT.A,{children:(0,n.jsx)(eE.A,{size:"small",variant:"contained",onClick:()=>{var t;return t=e.name,void(w({...C,author:t}),G(!1),$([]))},children:"Select"})})]},t))}):(0,n.jsx)(h.A,{textAlign:"center",p:3,children:(0,n.jsx)(Q.A,{color:"textSecondary",children:"No authors found for this title."})})]}),(0,n.jsx)(eK.A,{children:(0,n.jsx)(eE.A,{onClick:ex,children:"Cancel"})})]}),(0,n.jsxs)(eJ.A,{open:y,onClose:eu,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:"Import Books"}),(0,n.jsx)(eY.A,{children:(0,n.jsxs)(h.A,{sx:{mt:2},children:[(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Select a JSON file containing books to import. The file should be in the format exported by this application."}),(0,n.jsxs)(h.A,{sx:{mt:3,mb:2},children:[(0,n.jsx)("input",{accept:".json",style:{display:"none"},id:"import-file",type:"file",onChange:e=>{f(e.target.files[0])}}),(0,n.jsx)("label",{htmlFor:"import-file",children:(0,n.jsx)(eE.A,{variant:"outlined",component:"span",fullWidth:!0,startIcon:(0,n.jsx)(tu.A,{}),children:A?A.name:"Choose JSON File"})})]}),A&&(0,n.jsxs)(eZ.A,{severity:"info",sx:{mt:2},children:["File selected: ",A.name]})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:eu,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:em,variant:"contained",disabled:!A||b,children:b?"Importing...":"Import Books"})]})]}),(0,n.jsx)(eV.A,{open:p.open,autoHideDuration:4e3,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,n.jsx)(eZ.A,{onClose:Z,severity:p.severity,children:p.message})})]})};var tg=s(9306);let ty=function(){let{state:e,api:t}=Y(),{classes:s}=e,[a,i]=(0,r.useState)(!1),[o,l]=(0,r.useState)(null),[d,c]=(0,r.useState)({open:!1,message:"",severity:"success"}),[x,u]=(0,r.useState)({name:"",teacherName:"",schoolYear:""}),m=async e=>{if(window.confirm("Are you sure you want to delete this class?"))try{await t.deleteClass(e),c({open:!0,message:"Class deleted successfully",severity:"success"})}catch(e){c({open:!0,message:"Failed to delete class",severity:"error"})}},p=async()=>{try{o?(await t.updateClass(o.id,x),c({open:!0,message:"Class updated successfully",severity:"success"})):(await t.createClass(x),c({open:!0,message:"Class created successfully",severity:"success"})),i(!1)}catch(e){c({open:!0,message:"Failed to save class",severity:"error"})}},g=()=>{i(!1),l(null)},y=()=>{c({...d,open:!1})};return(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h4",children:"Classes"}),(0,n.jsx)(eE.A,{variant:"contained",startIcon:(0,n.jsx)(eb.A,{}),onClick:()=>{l(null),u({name:"",teacherName:"",schoolYear:""}),i(!0)},children:"Add Class"})]}),(0,n.jsx)(eI.A,{container:!0,spacing:3,children:s.map(e=>(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,lg:4,children:(0,n.jsx)(ek.A,{children:(0,n.jsxs)(eC.A,{children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",mb:2,children:[(0,n.jsx)(tg.A,{sx:{fontSize:40,color:"primary.main",mr:2}}),(0,n.jsxs)(h.A,{flexGrow:1,children:[(0,n.jsx)(Q.A,{variant:"h6",children:e.name}),e.teacherName&&(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:["Teacher: ",e.teacherName]}),e.schoolYear&&(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:["Year: ",e.schoolYear]})]})]}),(0,n.jsxs)(h.A,{display:"flex",justifyContent:"flex-end",children:[(0,n.jsx)(X.A,{onClick:()=>{l(e),u({name:e.name,teacherName:e.teacherName||"",schoolYear:e.schoolYear||""}),i(!0)},children:(0,n.jsx)(eX.A,{})}),(0,n.jsx)(X.A,{color:"error",onClick:()=>m(e.id),children:(0,n.jsx)(e0.A,{})})]})]})})},e.id))}),0===s.length&&(0,n.jsx)(ek.A,{sx:{textAlign:"center",py:8},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(tg.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No classes found"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Start by adding your first class"})]})}),(0,n.jsxs)(eJ.A,{open:a,onClose:g,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:o?"Edit Class":"Add New Class"}),(0,n.jsx)(eY.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Class Name",value:x.name,onChange:e=>u({...x,name:e.target.value}),required:!0})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Teacher Name",value:x.teacherName,onChange:e=>u({...x,teacherName:e.target.value})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"School Year",value:x.schoolYear,onChange:e=>u({...x,schoolYear:e.target.value}),placeholder:"e.g., Year 1, Year 2, etc."})})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:g,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:p,variant:"contained",disabled:!x.name.trim(),children:o?"Update":"Add Class"})]})]}),(0,n.jsx)(eV.A,{open:d.open,autoHideDuration:4e3,onClose:y,children:(0,n.jsx)(eZ.A,{onClose:y,severity:d.severity,children:d.message})})]})},tj=function(){let{state:e,api:t}=Y(),{genres:s}=e,[a,i]=(0,r.useState)(!1),[o,l]=(0,r.useState)(null),[d,c]=(0,r.useState)({open:!1,message:"",severity:"success"}),[x,u]=(0,r.useState)({name:"",description:""}),m=async e=>{if(window.confirm("Are you sure you want to delete this genre?"))try{await t.deleteGenre(e),c({open:!0,message:"Genre deleted successfully",severity:"success"})}catch(e){c({open:!0,message:"Failed to delete genre",severity:"error"})}},p=async()=>{try{o?(await t.updateGenre(o.id,x),c({open:!0,message:"Genre updated successfully",severity:"success"})):(await t.createGenre(x),c({open:!0,message:"Genre created successfully",severity:"success"})),i(!1)}catch(e){c({open:!0,message:"Failed to save genre",severity:"error"})}},g=()=>{i(!1),l(null)},y=()=>{c({...d,open:!1})};return(0,n.jsxs)(h.A,{children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,n.jsx)(Q.A,{variant:"h4",children:"Genres"}),(0,n.jsx)(eE.A,{variant:"contained",startIcon:(0,n.jsx)(eb.A,{}),onClick:()=>{l(null),u({name:"",description:""}),i(!0)},children:"Add Genre"})]}),(0,n.jsx)(eI.A,{container:!0,spacing:3,children:s.map(e=>(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,lg:4,children:(0,n.jsx)(ek.A,{children:(0,n.jsxs)(eC.A,{children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",mb:2,children:[(0,n.jsx)(ey.A,{sx:{fontSize:40,color:"primary.main",mr:2}}),(0,n.jsxs)(h.A,{flexGrow:1,children:[(0,n.jsx)(Q.A,{variant:"h6",children:e.name}),e.description&&(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:e.description})]})]}),(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(eD.A,{label:e.isPredefined?"Predefined":"Custom",size:"small",color:e.isPredefined?"primary":"default",variant:"outlined"}),(0,n.jsxs)(h.A,{children:[(0,n.jsx)(X.A,{onClick:()=>{l(e),u({name:e.name,description:e.description||""}),i(!0)},disabled:e.isPredefined,children:(0,n.jsx)(eX.A,{})}),(0,n.jsx)(X.A,{color:"error",onClick:()=>m(e.id),disabled:e.isPredefined,children:(0,n.jsx)(e0.A,{})})]})]})]})})},e.id))}),0===s.length&&(0,n.jsx)(ek.A,{sx:{textAlign:"center",py:8},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(ey.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No genres found"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Start by adding your first genre"})]})}),(0,n.jsxs)(eJ.A,{open:a,onClose:g,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(eq.A,{children:o?"Edit Genre":"Add New Genre"}),(0,n.jsx)(eY.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,sx:{mt:1},children:[(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Genre Name",value:x.name,onChange:e=>u({...x,name:e.target.value}),required:!0})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,multiline:!0,rows:3,label:"Description (optional)",value:x.description,onChange:e=>u({...x,description:e.target.value})})})]})}),(0,n.jsxs)(eK.A,{children:[(0,n.jsx)(eE.A,{onClick:g,children:"Cancel"}),(0,n.jsx)(eE.A,{onClick:p,variant:"contained",disabled:!x.name.trim(),children:o?"Update":"Add Genre"})]})]}),(0,n.jsx)(eV.A,{open:d.open,autoHideDuration:4e3,onClose:y,children:(0,n.jsx)(eZ.A,{onClose:y,severity:d.severity,children:d.message})})]})};var tA=s(4336),tf=s(8725);let tb=function(){var e;let{state:t,api:s}=Y(),{students:a,recommendations:i}=t,[o,l]=(0,r.useState)(""),[d,c]=(0,r.useState)(!1),[x,u]=(0,r.useState)([]),[m,p]=(0,r.useState)({open:!1,message:"",severity:"success"}),g=async()=>{if(o){c(!0);try{let e=await s.getRecommendations(o,5);u(e),p({open:!0,message:"Recommendations generated successfully",severity:"success"})}catch(e){p({open:!0,message:"Failed to generate recommendations",severity:"error"})}finally{c(!1)}}},y=()=>{p({...m,open:!1})},j=a.find(e=>e.id===o);return(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"h4",gutterBottom:!0,children:"Book Recommendations"}),(0,n.jsx)(ek.A,{sx:{mb:3},children:(0,n.jsx)(eC.A,{children:(0,n.jsxs)(eI.A,{container:!0,spacing:2,alignItems:"center",children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsxs)(ea.A,{fullWidth:!0,children:[(0,n.jsx)(ei.A,{children:"Select Student"}),(0,n.jsxs)(eo.A,{value:o,onChange:e=>l(e.target.value),label:"Select Student",sx:{fontSize:"1.4rem",minHeight:64,height:64,"& .MuiSelect-select":{padding:"20px 16px",fontSize:"1.4rem",minHeight:"24px"},"& .MuiInputLabel-root":{fontSize:"1.2rem"},"& .MuiMenuItem-root":{fontSize:"1.4rem",minHeight:56,padding:"12px 16px"},"& .MuiSelect-icon":{fontSize:"2rem"}},children:[(0,n.jsx)(el.A,{value:"",children:"Choose a student..."}),a.map(e=>(0,n.jsx)(el.A,{value:e.id,children:e.name},e.id))]})]})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(eE.A,{variant:"contained",fullWidth:!0,onClick:g,disabled:!o||d,startIcon:d?(0,n.jsx)(eU.A,{size:20}):(0,n.jsx)(tf.A,{}),children:d?"Generating...":"Generate Recommendations"})})]})})}),j&&(0,n.jsx)(ek.A,{sx:{mb:3},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsxs)(Q.A,{variant:"h6",gutterBottom:!0,children:["Selected Student: ",j.name]}),(0,n.jsxs)(h.A,{display:"flex",gap:1,flexWrap:"wrap",children:[j.readingLevel&&(0,n.jsx)(eD.A,{label:`Level: ${j.readingLevel}`,color:"primary",variant:"outlined"}),(0,n.jsx)(eD.A,{label:`${(null==(e=j.readingSessions)?void 0:e.length)||0} sessions logged`,variant:"outlined"})]})]})}),x.length>0&&(0,n.jsxs)(eI.A,{container:!0,spacing:3,children:[(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(Q.A,{variant:"h5",gutterBottom:!0,children:"Recommended Books"})}),x.map((e,s)=>(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(ek.A,{children:(0,n.jsx)(eC.A,{children:(0,n.jsxs)(h.A,{display:"flex",alignItems:"flex-start",children:[(0,n.jsx)(ep.A,{sx:{fontSize:40,color:"primary.main",mr:2,mt:1}}),(0,n.jsxs)(h.A,{flexGrow:1,children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,children:e.book.title}),(0,n.jsxs)(Q.A,{variant:"subtitle1",color:"textSecondary",gutterBottom:!0,children:["by ",e.book.author]}),e.book.genreIds&&(0,n.jsx)(h.A,{mb:2,children:e.book.genreIds.map(e=>{let s=t.genres.find(t=>t.id===e);return s?(0,n.jsx)(eD.A,{label:s.name,size:"small",variant:"outlined",sx:{mr:.5,mb:.5}},e):null})}),(0,n.jsxs)(h.A,{mb:2,children:[(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Recommendation Score:"}),(0,n.jsx)(tA.A,{value:Math.min(5,Math.max(1,Math.round(e.score))),readOnly:!0,size:"small"})]}),e.reasoning&&e.reasoning.length>0&&(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Why recommended:"}),(0,n.jsx)("ul",{style:{margin:0,paddingLeft:"1.2rem"},children:e.reasoning.map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:e})},t))})]})]})]})})})},s))]}),o&&!d&&0===x.length&&(0,n.jsx)(ek.A,{sx:{textAlign:"center",py:8},children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(eg.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,n.jsx)(Q.A,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No recommendations yet"}),(0,n.jsxs)(Q.A,{variant:"body2",color:"textSecondary",children:['Click "Generate Recommendations" to get personalized book suggestions for ',null==j?void 0:j.name]})]})}),(0,n.jsx)(eV.A,{open:m.open,autoHideDuration:4e3,onClose:y,children:(0,n.jsx)(eZ.A,{onClose:y,severity:m.severity,children:m.message})})]})};var tv=s(4845);let tS=function(){let{state:e,api:t}=Y(),{settings:s}=e,[a,i]=(0,r.useState)({recentlyReadDays:7,needsAttentionDays:14}),[o,l]=(0,r.useState)(!1),[d,c]=(0,r.useState)({open:!1,message:"",severity:"success"});(0,r.useEffect)(()=>{(null==s?void 0:s.readingStatusSettings)&&i({recentlyReadDays:s.readingStatusSettings.recentlyReadDays,needsAttentionDays:s.readingStatusSettings.needsAttentionDays})},[s]);let x=async()=>{l(!0);try{await t.updateSettings({readingStatusSettings:a}),c({open:!0,message:"Settings saved successfully",severity:"success"})}catch(e){c({open:!0,message:"Failed to save settings",severity:"error"})}finally{l(!1)}},u=()=>{c({...d,open:!1})},m=e=>t=>{let s=parseInt(t.target.value);i(t=>({...t,[e]:isNaN(s)?0:s}))};return(0,n.jsxs)(h.A,{children:[(0,n.jsx)(Q.A,{variant:"h4",gutterBottom:!0,children:"Settings"}),(0,n.jsxs)(eI.A,{container:!0,spacing:3,children:[(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(ek.A,{children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,children:"Reading Status Configuration"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",paragraph:!0,children:"Configure how the system determines reading status and attention requirements."}),(0,n.jsxs)(eI.A,{container:!0,spacing:3,children:[(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Recently Read (days)",type:"number",value:a.recentlyReadDays,onChange:m("recentlyReadDays"),helperText:"Students who have read within this many days are considered 'recently active'",inputProps:{min:1,max:365}})}),(0,n.jsx)(eI.A,{item:!0,xs:12,children:(0,n.jsx)(eN.A,{fullWidth:!0,label:"Needs Attention (days)",type:"number",value:a.needsAttentionDays,onChange:m("needsAttentionDays"),helperText:"Students who haven't read within this many days need attention",inputProps:{min:1,max:365}})})]}),a.recentlyReadDays>=a.needsAttentionDays&&(0,n.jsx)(eZ.A,{severity:"warning",sx:{mt:2},children:"Recently Read days should be less than Needs Attention days"}),(0,n.jsx)(h.A,{mt:3,children:(0,n.jsx)(eE.A,{variant:"contained",startIcon:(0,n.jsx)(tv.A,{}),onClick:x,disabled:o||a.recentlyReadDays>=a.needsAttentionDays,children:o?"Saving...":"Save Settings"})})]})})}),(0,n.jsx)(eI.A,{item:!0,xs:12,md:6,children:(0,n.jsx)(ek.A,{children:(0,n.jsxs)(eC.A,{children:[(0,n.jsx)(Q.A,{variant:"h6",gutterBottom:!0,children:"About Reading Assistant"}),(0,n.jsx)(Q.A,{variant:"body2",paragraph:!0,children:"A comprehensive reading tracking system designed for primary school teachers and volunteers to monitor student reading progress and provide personalized book recommendations."}),(0,n.jsx)(tt.A,{sx:{my:2}}),(0,n.jsx)(Q.A,{variant:"subtitle2",gutterBottom:!0,children:"Features:"}),(0,n.jsxs)("ul",{style:{margin:0,paddingLeft:"1.2rem"},children:[(0,n.jsx)("li",{children:(0,n.jsx)(Q.A,{variant:"body2",children:"Track reading sessions with detailed assessments"})}),(0,n.jsx)("li",{children:(0,n.jsx)(Q.A,{variant:"body2",children:"Manage student profiles and reading preferences"})}),(0,n.jsx)("li",{children:(0,n.jsx)(Q.A,{variant:"body2",children:"AI-powered book recommendations"})}),(0,n.jsx)("li",{children:(0,n.jsx)(Q.A,{variant:"body2",children:"Monitor reading progress and identify students needing attention"})}),(0,n.jsx)("li",{children:(0,n.jsx)(Q.A,{variant:"body2",children:"Comprehensive book and genre management"})})]}),(0,n.jsx)(tt.A,{sx:{my:2}}),(0,n.jsx)(Q.A,{variant:"subtitle2",gutterBottom:!0,children:"Data Storage:"}),(0,n.jsx)(Q.A,{variant:"body2",color:"textSecondary",children:"Built with Cloudflare Workers and KV storage for fast, reliable data access."})]})})})]}),(0,n.jsx)(eV.A,{open:d.open,autoHideDuration:4e3,onClose:u,children:(0,n.jsx)(eZ.A,{onClose:u,severity:d.severity,children:d.message})})]})};console.log("App.jsx loaded, defining routes...");let tk=(0,l.A)({palette:{mode:"light",primary:{main:"#6366f1",light:"#818cf8",dark:"#4f46e5",contrastText:"#ffffff"},secondary:{main:"#ec4899",light:"#f472b6",dark:"#db2777",contrastText:"#ffffff"},background:{default:"#f8fafc",paper:"#ffffff"},text:{primary:"#1e293b",secondary:"#64748b"},success:{main:"#10b981",light:"#34d399",dark:"#059669"},warning:{main:"#f59e0b",light:"#fbbf24",dark:"#d97706"},error:{main:"#ef4444",light:"#f87171",dark:"#dc2626"},info:{main:"#3b82f6",light:"#60a5fa",dark:"#2563eb"}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:700,fontSize:"2.5rem",lineHeight:1.2},h2:{fontWeight:600,fontSize:"2rem",lineHeight:1.3},h3:{fontWeight:600,fontSize:"1.75rem",lineHeight:1.4},h4:{fontWeight:600,fontSize:"1.5rem",lineHeight:1.4},h5:{fontWeight:600,fontSize:"1.25rem",lineHeight:1.5},h6:{fontWeight:600,fontSize:"1.125rem",lineHeight:1.5},body1:{fontSize:"1rem",lineHeight:1.6},body2:{fontSize:"0.875rem",lineHeight:1.6},subtitle1:{fontSize:"1rem",fontWeight:500,lineHeight:1.5},subtitle2:{fontSize:"0.875rem",fontWeight:500,lineHeight:1.5}},shape:{borderRadius:12},components:{MuiCard:{styleOverrides:{root:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease-in-out",borderRadius:12,"&:hover":{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.1)",transform:"translateY(-1px)"}}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:8,fontWeight:500,padding:"8px 16px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-1px)"}},contained:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)","&:hover":{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8,transition:"all 0.2s ease-in-out","&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(99, 102, 241, 0.5)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:"2px"}}}}},MuiSelect:{styleOverrides:{root:{fontSize:"1rem",minHeight:"48px",minWidth:"200px","& .MuiSelect-select":{padding:"12px 14px",fontSize:"1rem",minHeight:"24px"},"& .MuiInputLabel-root":{fontSize:"0.875rem"},"& .MuiSelect-icon":{fontSize:"1.25rem"}}}},MuiMenuItem:{styleOverrides:{root:{fontSize:"1rem",minHeight:"48px",padding:"12px 16px",borderRadius:6,margin:"2px 4px","&:hover":{backgroundColor:"rgba(99, 102, 241, 0.08)"},"&.Mui-selected":{backgroundColor:"rgba(99, 102, 241, 0.12)","&:hover":{backgroundColor:"rgba(99, 102, 241, 0.16)"}}}}},MuiIconButton:{styleOverrides:{root:{transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"rgba(99, 102, 241, 0.08)",transform:"scale(1.05)"}}}},MuiAutocomplete:{styleOverrides:{root:{"& .MuiInputBase-root":{fontSize:"1rem",minHeight:"48px",minWidth:"300px"},"& .MuiInputLabel-root":{fontSize:"0.875rem"},"& .MuiAutocomplete-popupIndicator":{fontSize:"1.25rem"}},option:{fontSize:"1rem",minHeight:"48px",padding:"12px 16px",borderRadius:6,margin:"2px 4px","&:hover":{backgroundColor:"rgba(99, 102, 241, 0.08)"}},listbox:{maxHeight:"300px",padding:"4px"}}},MuiChip:{styleOverrides:{root:{borderRadius:16,fontWeight:500,fontSize:"0.75rem",height:28},colorPrimary:{backgroundColor:"rgba(99, 102, 241, 0.1)",color:"#6366f1"},colorSecondary:{backgroundColor:"rgba(236, 72, 153, 0.1)",color:"#ec4899"}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:"#ffffff",color:"#1e293b",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1)"}}},MuiDrawer:{styleOverrides:{paper:{borderRight:"1px solid rgba(0, 0, 0, 0.05)"}}},MuiTableCell:{styleOverrides:{head:{backgroundColor:"#f8fafc",fontWeight:600,fontSize:"0.875rem",color:"#64748b",borderBottom:"1px solid #e2e8f0"},body:{fontSize:"0.875rem",borderBottom:"1px solid #f1f5f9"}}}}}),tC=document.getElementById("root");(0,a.createRoot)(tC).render((0,n.jsx)(r.StrictMode,{children:(0,n.jsx)(function(){return(0,n.jsxs)(d.A,{theme:tk,children:[(0,n.jsx)(c.Ay,{}),(0,n.jsx)(q,{children:(0,n.jsx)(i.Kd,{children:(0,n.jsx)(h.A,{sx:{display:"flex",minHeight:"100vh"},children:(0,n.jsx)(eS,{children:(0,n.jsxs)(o.BV,{children:[(0,n.jsx)(o.qh,{path:"/",element:(0,n.jsx)(eP,{})}),(0,n.jsx)(o.qh,{path:"/students/:id",element:(0,n.jsx)(tr,{})}),(0,n.jsx)(o.qh,{path:"/students",element:(0,n.jsx)(te,{})}),(0,n.jsx)(o.qh,{path:"/sessions",element:(0,n.jsx)(tx,{})}),(0,n.jsx)(o.qh,{path:"/books",element:(0,n.jsxs)(n.Fragment,{children:[console.log("Rendering BooksPage route")||null,(0,n.jsx)(tp,{})]})}),(0,n.jsx)(o.qh,{path:"/classes",element:(0,n.jsx)(ty,{})}),(0,n.jsx)(o.qh,{path:"/genres",element:(0,n.jsx)(tj,{})}),(0,n.jsx)(o.qh,{path:"/recommendations",element:(0,n.jsx)(tb,{})}),(0,n.jsx)(o.qh,{path:"/settings",element:(0,n.jsx)(tS,{})})]})})})})})]})},{})}))}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var s=o[e]={exports:{}};return i[e](s,s.exports,l),s.exports}l.m=i,l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(s,n){if(1&n&&(s=this(s)),8&n||"object"==typeof s&&s&&(4&n&&s.__esModule||16&n&&"function"==typeof s.then))return s;var r=Object.create(null);l.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var i=2&n&&s;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach(e=>{a[e]=()=>s[e]});return a.default=()=>s,l.d(r,a),r},l.d=(e,t)=>{for(var s in t)l.o(t,s)&&!l.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s=[],l.O=(e,t,n,r)=>{if(t){r=r||0;for(var a=s.length;a>0&&s[a-1][2]>r;a--)s[a]=s[a-1];s[a]=[t,n,r];return}for(var i=1/0,a=0;a<s.length;a++){for(var[t,n,r]=s[a],o=!0,d=0;d<t.length;d++)(!1&r||i>=r)&&Object.keys(l.O).every(e=>l.O[e](t[d]))?t.splice(d--,1):(o=!1,r<i&&(i=r));if(o){s.splice(a--,1);var c=n();void 0!==c&&(e=c)}}return e},n={410:0},l.O.j=e=>0===n[e],r=(e,t)=>{var s,r,[a,i,o]=t,d=0;if(a.some(e=>0!==n[e])){for(s in i)l.o(i,s)&&(l.m[s]=i[s]);if(o)var c=o(l)}for(e&&e(t);d<a.length;d++)r=a[d],l.o(n,r)&&n[r]&&n[r][0](),n[r]=0;return l.O(c)},(a=self.webpackChunkreading_assistant=self.webpackChunkreading_assistant||[]).forEach(r.bind(null,0)),a.push=r.bind(null,a.push.bind(a));var d=l.O(void 0,["783","535","548"],function(){return l(1464)});d=l.O(d)})();